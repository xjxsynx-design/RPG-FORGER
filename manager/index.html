<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RPG Forgeworks — Manager</title>
<style>
*,*::before,*::after{box-sizing:border-box;}
input, select, textarea {max-width:100%;}
:root{
  --font-ui: system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
  --font-accent: Chalkduster,'Chalkboard SE','Marker Felt','Bradley Hand',cursive;

  --bg:#000000;
  --panel:#111317;
  --panel-2:#161b22;

  --text:#e7e7ea;
  --muted:#b6b8c0;

  --steel:#2e3440;
  --steel-border:#6b7280;

  --ember:#c2410c;
  --ember-hover:#ea580c;

  --earth:#4d7c59;
  --select:#22ff66;
  --warn:#f97316;

  --purple: #7b5cff;

  --purple2: #5f46e6;

  --forge: #ff7a18;

  --ink: #e9e6ff;
}
body{margin:0;background:var(--bg);color:var(--text);font-family:var(--font-ui)}
.hidden{display:none!important}
header{
  text-align:center;
  padding:16px 16px 8px;
}
header img{
  max-width:220px;
  width:60%;
  display:block;
  margin:0 auto 8px;
}
header .label{
  font-size:14px;
  letter-spacing:3px;
  color:#b7b0e6;
}
.container{
  max-width:420px;
  margin:auto;
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:14px;
}
button{
  cursor:pointer;
  font-family: Chalkduster, "Chalkboard SE", system-ui, -apple-system;
  letter-spacing: 1px;
  color:#fff;
  border-radius:18px;
  padding:14px 20px;
  font-size:18px;
  border:2px solid rgba(255,122,24,.78);
  background: linear-gradient(180deg, rgba(40,28,70,.94), rgba(14,10,28,.98));
  box-shadow:
    0 14px 34px rgba(0,0,0,.58),
    0 0 0 6px rgba(255,122,24,.10),
    0 0 26px rgba(255,122,24,.18),
    inset 0 0 0 2px rgba(123,92,255,.26),
    inset 0 12px 18px rgba(255,255,255,.05);
  text-shadow: 0 2px 10px rgba(0,0,0,.55);
  transition: transform .12s ease, filter .12s ease;
}
button:hover{transform:translateY(-1px);filter:brightness(1.05)}
button:active{transform:translateY(0px);filter:brightness(.98)}
button.primary{font-size:20px;padding:16px 22px}
button.secondary{
  background: rgba(14,10,28,.75);
  box-shadow:
    0 12px 28px rgba(0,0,0,.55),
    0 0 0 5px rgba(255,122,24,.08),
    0 0 22px rgba(255,122,24,.14),
    inset 0 0 0 2px rgba(123,92,255,.22),
    inset 0 10px 16px rgba(255,255,255,.04);
}
.card{
  background:#16102a;
  border-radius:14px;
  padding:12px;
}
.meta{
  font-size:13px;
  color:#b7b0e6;
}
.row{
  display:flex;
  gap:8px;
  margin-top:10px;
}
.row button{
  flex:1;
  padding:10px;
  font-size:13px;
}
.backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
}
.modal{
  width:100%;
  max-width:420px;
  background:#120b22;
  border:1px solid #3a2b7a;
  border-radius:18px;
  padding:16px;
}
label{
  font-size:13px;
  color:#b7b0e6;
}
input,select{
  width:100%;
  padding:12px;
  margin:8px 0 14px;
  border-radius:10px;
  border:1px solid #3a2b7a;
  background:#120b22;
  color:#efeaff;
}

/* Typography system: UI vs Accent */
h1,h2,h3,
button,.btn,.primary,.secondary,
.modal h3,.modal h2,.modal-title,
.toast,.pill,.label,.header-title{
  font-family: var(--font-accent);
  letter-spacing: 0.02em;
}
input,select,textarea,small,p,li,span,div{
  font-family: var(--font-ui);
}


/* ========== Forgeworks v1.1 — Manager cinematic polish (visual only) ========== */
:root{
  --ui-text:#e9e6f2;
  --forge-ember:#ff7a18;
}
body{
  background: radial-gradient(circle at 50% 10%, rgba(255,122,24,0.10), rgba(0,0,0,0.92) 55%, rgba(0,0,0,0.98) 100%);
  color: var(--ui-text);
}
.forge-btn, .primary, button.primary{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding: 12px 18px;
  border-radius: 999px;
  border: 1px solid rgba(255,122,24,0.35);
  background: linear-gradient(180deg, rgba(59,15,88,0.92), rgba(21,10,36,0.92));
  box-shadow:
    0 10px 26px rgba(0,0,0,0.55),
    0 0 0 1px rgba(255,122,24,0.10) inset,
    0 0 28px rgba(255,122,24,0.18);
  color: #fff;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
.forge-btn:active, .primary:active{ transform: translateY(1px); }
.modal, .panel, .card{
  background: rgba(10,10,14,0.78);
  border: 1px solid rgba(255,122,24,0.18);
  box-shadow: 0 18px 40px rgba(0,0,0,0.65);
  backdrop-filter: blur(10px);
}
.modal h3, .modal h2{
  font-family: Chalkduster, "Chalkboard SE", "Marker Felt", system-ui, sans-serif;
}
input, select, textarea{ font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

</style>
</head>
<body>

<header>
  <img src="../assets/rpg_forgeworks_logo.png" alt="RPG DREAM Logo">
  <div class="label">MANAGER</div>
</header>

<div class="container">
  <button class="forge-btn" onclick="openNew()">New Project</button>
  <button class="secondary" onclick="openLoad()">Load From Local Storage</button>
</div>

<!-- NEW PROJECT MODAL -->
<div class="backdrop hidden" id="newModal">
  <div class="modal">
    <h3>Create New Project</h3>

    <label>Project Name</label>
    <input id="projectName">

    <!-- View is selected inside the Editor (mandatory on first open). -->

    <label>Grid Preset</label>
    <select id="grid">
      <option value="small">Small</option>
      <option value="medium">Medium</option>
      <option value="large">Large</option>
    </select>

    <label>Tile Size</label>
    <select id="tile">
      <option>16</option>
      <option selected>32</option>
      <option>48</option>
      <option>64</option>
      <option>96</option>
      <option>128</option>
    </select>

    <button class="forge-btn" onclick="createProject()">Create</button>
    <button class="secondary" onclick="closeNew()">Cancel</button>
  </div>
</div>

<!-- LOAD PROJECT MODAL -->
<div class="backdrop hidden" id="loadModal">
  <div class="modal">
    <h3>Local Projects</h3>
    <div id="projectList"></div>
    <button class="secondary" onclick="closeLoad()">Close</button>
  </div>
</div>

<script>
function getProjects(){
  return JSON.parse(localStorage.getItem("rpgdream_projects")||"[]");
}
function saveProjects(p){
  localStorage.setItem("rpgdream_projects",JSON.stringify(p));
}
function openEditor(project){
  localStorage.setItem("rpgdream_active_project",JSON.stringify(project));
  location.href="../editor/index.html";
}
function renderProjects(){
  const list=document.getElementById("projectList");
  list.innerHTML="";
  getProjects().forEach(p=>{
        const activeId = p?.editor?.activeMapId || p?.data?.editor?.activeMapId || p?.maps?.[0]?.id;
    const activeMap = (p?.maps||p?.data?.maps||[]).find(m=>m.id===activeId) || (p?.maps||p?.data?.maps||[])[0] || {};
    const viewLabel = activeMap.viewMode || p?.data?.view || p.view || "unset";
    const tileLabel = (p?.data?.tileSize ?? p.tile ?? "?") + "px";
    const gridLabel = (p?.data?.grid?.preset ?? p.grid ?? "?");
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<strong>${p.name}</strong>
      <div class="meta">${viewLabel} • ${tileLabel} • ${gridLabel}</div>`;
    const row=document.createElement("div");
    row.className="row";
    row.innerHTML=`
      <button class="forge-btn" onclick='openEditor(${JSON.stringify(p)})'>Continue</button>
      <button class="secondary" onclick='renameProj("${p.id}")'>Rename</button>
      <button class="secondary" onclick='deleteProj("${p.id}")'>Delete</button>
    `;
    card.appendChild(row);
    list.appendChild(card);
  });
}
function createProject(){
  const maps = [{
    id:"map_1",
    name:"Map 1",
    viewMode:null,
    tiles:[],
    regions:[],
    objects:[]
  }];

  const project = {
    id:"p_"+Date.now(),
    name: projectName.value || "Untitled Project",
    maps: maps,
    data:{
      view:null, // set inside editor (kept for backward compatibility)
      tileSize: parseInt(tile.value,10),
      grid:{ preset: grid.value }
    },
    editor:{ activeMapId:"map_1" }
  };

  const projects = getProjects();
  projects.unshift(project);
  saveProjects(projects);
  openEditor(project);
}
function renameProj(id){
  const projects=getProjects();
  // MIGRATION: accept older shape with maps in data.maps
  projects.forEach(p=>{
    if(!Array.isArray(p.maps) && p.data && Array.isArray(p.data.maps)) p.maps = p.data.maps;
    if(!p.data || typeof p.data!=="object") p.data = p.data||{};
    if(Array.isArray(p.maps)) p.data.maps = p.maps;
  });

  const p=projects.find(x=>x.id===id);
  const n=prompt("Rename project",p.name);
  if(n){p.name=n;saveProjects(projects);renderProjects();}
}
function deleteProj(id){
  if(confirm("Delete project?")){
    saveProjects(getProjects().filter(p=>p.id!==id));
    renderProjects();
  }
}
function openNew(){ newModal.classList.remove("hidden"); }
function closeNew(){ newModal.classList.add("hidden"); }
function openLoad(){ renderProjects(); loadModal.classList.remove("hidden"); }
function closeLoad(){ loadModal.classList.add("hidden"); }
</script>

</body>
</html>
